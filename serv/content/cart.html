<!DOCTYPE html>
<html lang="en">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Cart basics</title>

   <style>
html, body {
    height: 100%;
}
#errors {
  color: red;
}

#arena {
    position: relative;
    height: 75%;
    width: 50%;
    background-image: url("grassy.jpg");
    background-size: cover;
    margin-top: 1em;
}
   </style>
   <script src="rezoom.js"></script>
   <script src="drag.js"></script>
   <script src="grassy-drive.js"></script>
   <script>

function maybeSendMotion(fx, fy) {
    // fx, fy are fractions (0..1) of the way across the arena.
    // First, translate each to -1..+1
    // then combine them the motor power.
    var signed = function signed(motor, f) {
        // dead zone in the middle for each direction
        if (f < deadZone[motor].low) {
            return -lerp(f, deadZone[motor].low, 0, 0, fullThrottlePWM);
        } else if (f > deadZone[motor].high) {
	    return lerp(f, deadZone[motor].high, 1, 0, fullThrottlePWM);
        } else {
	    return 0.0;
        }
    };
    //---throttle and steering are misnomers for left-right motors
    var pthrottle = signed("throttle", fy);
    var psteering = -signed("steering", fx);
    // Add the steering to the right, subtract from left
    var pleft = pthrottle - psteering;
    var pright = pthrottle + psteering;
    pleft = round3(pleft);
    pright = round3(pright);
    pright = -pright;	// fix wiring error
    console.log(`fx ${fx} fy ${fy} pleft ${pleft} pright ${pright}`);
    // Convert back to sign-magnitude
    desiredSetting["steering"].direction = (pleft < 0)? "A" : "B";
    desiredSetting["steering"].speed = Math.min(1.0, Math.abs(pleft));
    desiredSetting["throttle"].direction = (pright < 0)? "A" : "B";
    desiredSetting["throttle"].speed = Math.min(1.0, Math.abs(pright));

    queueMotion();
}

   </script>
</head>
<body>

<h1>Basic control of cart</h1>
<a href="/"><i>Back to Command Central</i></a><p>
<div id="errors""></div>

<div id="arena" onmousedown="arenaClick(event)" ontouchstart="arenaTouch(event)"></div>

</body></html>
